<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>SSARP (Species-/Speciation-Area Relationship Projector) • SSARP</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="SSARP (Species-/Speciation-Area Relationship Projector)">
<meta name="description" content="Create Species- and Speciation-Area Relationships for any taxa.">
<meta property="og:description" content="Create Species- and Speciation-Area Relationships for any taxa.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">SSARP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/Create_SAR.html">Create Species-Area Relationship</a></li>
    <li><a class="dropdown-item" href="articles/Create_SpAR.html">Create Speciation-Area Relationship</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kmartinet/SSARP/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="ssarp">SSARP<a class="anchor" aria-label="anchor" href="#ssarp"></a>
</h1></div>
<p><!-- badges: start --> <a href="https://codecov.io/gh/kmartinet/SSARP?branch=main" class="external-link"><img src="https://codecov.io/gh/kmartinet/SSARP/branch/main/graph/badge.svg" alt="Codecov test coverage"></a> <a href="https://github.com/kmartinet/SSARP/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/kmartinet/SSARP/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a> <a href="https://www.repostatus.org/#active" class="external-link"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active – The project has reached a stable, usable state and is being actively developed."></a> <!-- badges: end --></p>
<p>SSARP (Species-/Speciation-Area Relationship Projector) is an R package that provides a suite of functions to help users <strong>create speciation- and species-area relationships for island-dwelling taxa</strong> using occurrence data from GBIF (Global Biodiversity Information Facility) accessed via GBIF’s API or the user’s own occurrence data.</p>
<p>Species- and speciation-area relationships are useful for determining whether biodiversity is distributed in an unusual way in a given island system (e.g., species richness decreasing as islands get larger instead of increasing). An unusual trend in these relationships may be indicative of habitat loss or a negative impact of non-native species.</p>
<p>Please find the <a href="https://www.biorxiv.org/content/10.1101/2024.12.31.630948v1" class="external-link">bioRxiv preprint of the manuscript associated with <em>SSARP</em> here!</a></p>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>To install <em>SSARP</em>, use the “install_github” function from the <em>devtools</em> package:</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">install_github</span><span class="op">(</span><span class="st">"kmartinet/SSARP"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="example-creating-a-species-area-relationship">Example: Creating a Species-Area Relationship<a class="anchor" aria-label="anchor" href="#example-creating-a-species-area-relationship"></a>
</h3>
<p>A species-area relationship (SAR) visualizes the relationship between species richness (the number of species) and the area of the land mass on which the species live. This brief example covers the <em>SSARP</em> workflow for creating a SAR, and more detailed explanations of the code and methods can be found <a href="https://kmartinet.github.io/SSARP/index.html">in the Articles on the SSARP pkgdown website</a>.</p>
<p>In order to construct a species-area relationship with <em>SSARP</em>, we will:</p>
<ul>
<li>Gather occurrence data from GBIF</li>
<li>Filter out invalid occurrence records</li>
<li>Find areas of pertinent land masses</li>
<li>Create a species-area relationship</li>
</ul>
<div class="section level4">
<h4 id="step-1-gather-occurrence-data-from-gbif">Step 1: Gather occurrence data from GBIF<a class="anchor" aria-label="anchor" href="#step-1-gather-occurrence-data-from-gbif"></a>
</h4>
<p>In this step, we will find the unique identifying key associated with a taxon of interest (the lizard genus <em>Anolis</em> in this case) and use that key to access occurrence points for that taxon from GBIF. We will restrict the returned occurrence records to the Caribbean islands using the “geometry” parameter in the “getData” function.</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kmartinet/SSARP" class="external-link">SSARP</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the GBIF key for the Anolis genus</span></span>
<span><span class="va">key</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getKey.html">getKey</a></span><span class="op">(</span>query <span class="op">=</span> <span class="st">"Anolis"</span>, rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get data for Anolis from GBIF in a specified polygon around Caribbean islands</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getData.html">getData</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">key</span>, limit <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  geometry <span class="op">=</span> <span class="st">'POLYGON((-84.8 23.9, -84.7 16.4, -65.2 13.9, -63.1 11.0, -56.9 15.5, -60.5 21.9, -79.3 27.8, -79.8 24.8, -84.8 23.9))'</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="step-2-filter-out-invalid-occurrence-records">Step 2: Filter out invalid occurrence records<a class="anchor" aria-label="anchor" href="#step-2-filter-out-invalid-occurrence-records"></a>
</h4>
<p>Now that we have a dataframe that includes the first 10,000 records for <em>Anolis</em> within a specified polygon around the Caribbean islands, we will filter that data to include only occurrence records that are on land. Some occurrence records might have GPS points that are in the ocean instead of on an island, so it is important to exclude these invalid records.</p>
<pre><code><span><span class="co"># Find land mass names and exclude records not on land</span></span>
<span><span class="va">land_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/findLand.html">findLand</a></span><span class="op">(</span>occurrences <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="step-3-find-areas-of-pertinent-land-masses">Step 3: Find areas of pertinent land masses<a class="anchor" aria-label="anchor" href="#step-3-find-areas-of-pertinent-land-masses"></a>
</h4>
<p>Next, we will use the dataframe of occurrence records with their associated land mass names (the “land_dat” object created above) with the “findAreas” function to find the area of each land mass.</p>
<pre><code><span><span class="co"># Use the land mass names to get their areas</span></span>
<span><span class="va">area_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/findAreas.html">findAreas</a></span><span class="op">(</span>occs <span class="op">=</span> <span class="va">land_dat</span><span class="op">)</span></span></code></pre>
<p>To ensure that occurrence records included in our SAR are all on islands, we will use the “removeContinents” function to remove any continental occurrence records. While we specified a polygon around Caribbean islands in Step 1, some continental occurrence records may have been accidentally included due to user error when specifying the WKT polygon.</p>
<pre><code><span><span class="va">nocont_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/removeContinents.html">removeContinents</a></span><span class="op">(</span>occs <span class="op">=</span> <span class="va">area_dat</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="step-4-create-a-species-area-relationship">Step 4: Create a species-area relationship<a class="anchor" aria-label="anchor" href="#step-4-create-a-species-area-relationship"></a>
</h4>
<p>Finally, we will use the “nocont_dat” object created in Step 3 with the “SARP” function to create a SAR for <em>Anolis</em> lizards found on islands in the Caribbean. The “SARP” function creates multiple regression objects with breakpoints up to the user-specified “npsi” parameter. For example, if “npsi” is two, “SARP” will generate regression objects with zero (linear regression), one, and two breakpoints. The function will then return the regression object with the lowest AIC score. The “npsi” parameter will be set to one in this example.</p>
<pre><code><span><span class="fu"><a href="reference/SARP.html">SARP</a></span><span class="op">(</span>occurrences <span class="op">=</span> <span class="va">nocont_dat</span>, npsi <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
<div class="float">
<img src="https://github.com/kmartinet/SSARP/blob/main/vignettes/anolis_SAR-1.png?raw=true" alt="alt text"><div class="figcaption">alt text</div>
</div>
<p>This is the species-area relationship (SAR) for Anolis including island-based occurrences within a polygon around Caribbean islands from the first 10000 records for the genus in GBIF! The best-fit model was a segmented regression with one breakpoint. The R console will also output statistical information about the model:</p>
<pre><code><span><span class="co">##</span></span>
<span><span class="co">##  ***Regression Model with Segmented Relationship(s)***</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## segmented.lm(obj = linear, seg.Z = ~x, npsi = 1, control = seg.control(display = FALSE))</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## Estimated Break-Point(s):</span></span>
<span><span class="co">##           Est. St.Err</span></span>
<span><span class="co">## psi1.x 21.982  0.723</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## Coefficients of the linear terms:</span></span>
<span><span class="co">##             Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">## (Intercept) -0.84251    1.00776  -0.836    0.409</span></span>
<span><span class="co">## x            0.08500    0.05405   1.573    0.125</span></span>
<span><span class="co">## U1.x         0.71424    0.21612   3.305       NA</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## Residual standard error: 0.5664 on 34 degrees of freedom</span></span>
<span><span class="co">## Multiple R-Squared: 0.6441,  Adjusted R-squared: 0.6127</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## Boot restarting based on 8 samples. Last fit:</span></span>
<span><span class="co">## Convergence attained in 2 iterations (rel. change 3.648e-10)</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="workflow-summary-for-using-data-from-gbif-to-create-a-species-area-relationship-plot">Workflow Summary for using data from GBIF to create a species-area relationship plot<a class="anchor" aria-label="anchor" href="#workflow-summary-for-using-data-from-gbif-to-create-a-species-area-relationship-plot"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Use <code>getKey(query, rank)</code> to find the unique identifying key associated with your taxon of interest.<br>
</li>
<li>Use <code>getData(key, limit, geometry)</code> with the key found in Step 1 to access <em>limit</em> occurrence points from GBIF. There is a hard limit of 100,000 records for each call to <code><a href="reference/getData.html">getData()</a></code>, as set by <a href="https://www.gbif.org/tool/81747/rgbif" class="external-link"><em>rgbif</em></a>. The “geometry” parameter can be specified with a well-known text (WKT) representation of of geometry to restrict the geographic location of the returned occurrence records (see more about WKT below).</li>
<li>Use <code>findLand(occ, fillgaps)</code> with the dataframe obtained in Step 2 to figure out the names of landmasses using the occurrence record GPS points and the <a href="https://cran.r-project.org/web/packages/maps/index.html" class="external-link"><em>maps</em> R package</a>. Setting the “fillgaps” parameter to <code>TRUE</code> will enable the use of <a href="https://photon.komoot.io/" class="external-link">Photon API</a> to fill in any missing landmass names left by the <em>maps</em> R package.</li>
<li>Use <code>findAreas(occ, area_custom)</code> with the dataframe obtained in Step 3 to match the landmass names to a dataset that includes names of most islands on the planet and their areas. If the user would like to use a custom island area dataset instead of the built-in one, the “area_custom” parameter can be set to the name of the custom island area dataframe. 4a. If you’d like to only include occurrence records from islands, you can remove continental records by using <code>removeContinents(occ)</code> with the dataframe returned by <code><a href="reference/findAreas.html">findAreas()</a></code>
</li>
<li>Use <code>SARP(occ, npsi)</code> with the dataframe obtained in Step 4 to create a species-area relationship plot that reports information important to the associated regression. The “npsi” parameter indicates the maximum number of breakpoints the user would like to compare for model selection. The returned model and plot correspond with the best-fit model.</li>
</ol>
</div>
<div class="section level3">
<h3 id="workflow-summary-for-using-data-from-gbif-and-a-user-provided-phylogenetic-tree-to-create-a-speciation-area-relationship-plot">Workflow summary for using data from GBIF and a user-provided phylogenetic tree to create a speciation-area relationship plot<a class="anchor" aria-label="anchor" href="#workflow-summary-for-using-data-from-gbif-and-a-user-provided-phylogenetic-tree-to-create-a-speciation-area-relationship-plot"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Use <code>getKey(query, rank)</code> to find the unique identifying key associated with your taxon of interest.<br>
</li>
<li>Use <code>getData(key, limit, geometry)</code> with the key found in Step 1 to access <em>limit</em> occurrence points from GBIF. There is a hard limit of 100,000 records for each call to <code><a href="reference/getData.html">getData()</a></code>, as set by <a href="https://www.gbif.org/tool/81747/rgbif" class="external-link"><em>rgbif</em></a>. The “geometry” parameter can be specified with a well-known text (WKT) representation of of geometry to restrict the geographic location of the returned occurrence records (see more about WKT below).</li>
<li>Use <code>findLand(occ, fillgaps)</code> with the dataframe obtained in Step 2 to figure out the names of landmasses using the occurrence record GPS points and the <a href="https://cran.r-project.org/web/packages/maps/index.html" class="external-link"><em>maps</em> R package</a>. Setting the “fillgaps” parameter to <code>TRUE</code> will enable the use of <a href="https://photon.komoot.io/" class="external-link">Photon API</a> to fill in any missing landmass names left by the <em>maps</em> R package.</li>
<li>Use <code>findAreas(occ, area_custom)</code> with the dataframe obtained in Step 3 to match the landmass names to a dataset that includes names of most islands on the planet and their areas. If the user would like to use a custom island area dataset instead of the built-in one, the “area_custom” parameter can be set to the name of the custom island area dataframe. 4a. If you’d like to only include occurrence records from islands, you can remove continental records by using <code>removeContinents(occ)</code> with the dataframe returned by <code><a href="reference/findAreas.html">findAreas()</a></code>
</li>
<li>Use either <code>speciationDR(tree, label_type, occ)</code> or <code>speciationMS(tree, label_type, occ)</code> with your own phylogenetic tree that corresponds with the taxa signified in previous steps, a classifier that describes your tip labels (whether the tip labels are simply species epithets or full scientific names), and the dataframe obtained in Step 4 to add tip speciation rates using the DR statistic (Jetz et al. 2012) or the lambda calculation for crown groups from Magallόn and Sanderson (2001) respectively to the occurrence dataframe. The user may also choose to estimate tip speciation rates from a BAMM analysis (Rabosky 2014) by using <code>speciationBAMM(label_type, occ, edata)</code> with a classifier that describes your tip labels (whether the tip labels are simply species epithets or full scientific names), the occurrence record dataframe obtained in Step 4, and a bammdata object generated by reading the event data file from a BAMM analysis with the <em>BAMMtools</em> package (Rabosky et al. 2014).</li>
<li>Use <code>SpeARP(occ, npsi)</code> with the dataframe obtained in Step 5 to create a speciation-area relationship plot that reports information important to the associated regression. The “npsi” parameter indicates the maximum number of breakpoints the user would like to compare for model selection. The returned model and plot correspond with the best-fit model.</li>
</ol>
</div>
<div class="section level3">
<h3 id="some-helpful-notes-about-well-known-text-wkt-representation-of-geometry">Some helpful notes about well-known text (WKT) representation of geometry<a class="anchor" aria-label="anchor" href="#some-helpful-notes-about-well-known-text-wkt-representation-of-geometry"></a>
</h3>
<p>When running <code><a href="reference/getData.html">getData()</a></code>, the user can specify a well-known text (WKT) representation of geometry to restrict the geographic location of the returned occurrence records. The rgbif::occ_search function that <code><a href="reference/getData.html">getData()</a></code> calls requires a counter-clockwise winding order for WKT. I find it helpful to think about WKT polygons in this way: imagine a square around your geographic area of interest and pick one of the corners as a starting point. The order of points in WKT format should follow counter-clockwise from the corner you picked first, and the final entry in the WKT string needs to be the same as the first entry. Additionally, while GPS points are typcially represented in “latitude, longitude” format, WKT expects them in “longitude latitude” format with commas separating the points rather than individual longitude and latitude values. WKT polygons can have more specified points than included in this simple square example, and even include polygons nested within others or polygons with holes in the middle.</p>
<div class="section level4">
<h4 id="literature-cited">Literature Cited<a class="anchor" aria-label="anchor" href="#literature-cited"></a>
</h4>
<ul>
<li>Jetz, W., Thomas, G.H, Joy, J.B., Harmann, K., &amp; Mooers, A.O. (2012). The global diversity of birds in space and time. <em>Nature</em>, 491: 444-448.</li>
<li>Magallόn, S. &amp; Sanderson, M.J. (2001). Absolute Diversification Rates in Angiosperm Clades. <em>Evolution</em>, 55(9): 1762-1780.</li>
<li>Rabosky, D.L. (2014). Automatic Detection of Key Innovations, Rate Shifts, and Diversity-Dependence on Phylogenetic Trees. PLOS ONE, 9(2): e89543.436</li>
<li>Rabosky, D.L., Grundler, M., Anderson, C., Title, P., Shi, J.J., Brown, J.W., Huang, H., &amp; Larson, J.G. (2014). BAMMtools: an R package for the analysis of evolutionary dynamics on phylogenetic trees. Methods in Ecology and Evolution, 5: 701-707.</li>
</ul>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/kmartinet/SSARP/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/kmartinet/SSARP/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;=2)</li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing SSARP</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Kristen Martinet <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kristen Martinet.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
