<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Get Occurrence Records from GBIF • SSARP</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get Occurrence Records from GBIF">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SSARP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Create_SAR.html">Create Species-Area Relationship</a></li>
    <li><a class="dropdown-item" href="../articles/Create_SpAR.html">Create Speciation-Area Relationship</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kmartinet/SSARP/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Get Occurrence Records from GBIF</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kmartinet/SSARP/blob/main/vignettes/Get_Data.Rmd" class="external-link"><code>vignettes/Get_Data.Rmd</code></a></small>
      <div class="d-none name"><code>Get_Data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The main goal of the <em>SSARP</em> R package is to create
species-area relationships (SARs) when occurrence records are given as
input, and speciation-area relationships (SpARs) when occurrence records
and a phylogeny associated with the taxa of interest are given as
input.</p>
<p>In this vignette, we will explore different options for gathering
occurrence records using the <em>rgbif</em> package, which allows us to
access data on GBIF (Global Biodiversity Information Facility) through
the use of the GBIF API. These records can then be used in
<em>SSARP</em>’s workflow to <a href="https://kmartinet.github.io/SSARP/articles/Create_SAR.html">create
SARs</a> and <a href="https://kmartinet.github.io/SSARP/articles/Create_SpAR.html">create
SpARs</a>.</p>
</div>
<div class="section level2">
<h2 id="obtaining-a-taxon-key">Obtaining a Taxon Key<a class="anchor" aria-label="anchor" href="#obtaining-a-taxon-key"></a>
</h2>
<p>In order to access data from GBIF, we must first determine the unique
identifying key associated with the taxon of interest. We will use the
<code><a href="https://docs.ropensci.org/rgbif/reference/name_suggest.html" class="external-link">rgbif::name_suggest()</a></code> function to find this key. To
illustrate the use of <code><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">rgbif::occ_download()</a></code>, we will focus
on the lizard species <em>Anolis allisoni</em>.</p>
<p>Please note that creating a SAR or SpAR for one species is not
informative. This example focuses on one species to reduce the time for
downloading occurrence records.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rgbif" class="external-link">rgbif</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Taxon query</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="st">"Anolis allisoni"</span></span>
<span><span class="co"># Taxon rank</span></span>
<span><span class="va">rank</span> <span class="op">&lt;-</span> <span class="st">"Species"</span></span>
<span></span>
<span><span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/name_suggest.html" class="external-link">name_suggest</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">query</span>, rank <span class="op">=</span> <span class="va">rank</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Records returned [1] </span></span>
<span><span class="co">## No. unique hierarchies [0] </span></span>
<span><span class="co">## Args [q=Anolis allisoni, limit=100, rank=Species, fields1=key,</span></span>
<span><span class="co">##      fields2=canonicalName, fields3=rank] </span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##       key canonicalName   rank   </span></span>
<span><span class="co">##     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 2<span style="text-decoration: underline;">467</span>262 Anolis allisoni SPECIES</span></span></code></pre>
<p>The <code><a href="https://docs.ropensci.org/rgbif/reference/name_suggest.html" class="external-link">rgbif::name_suggest()</a></code> function will return a tibble
with taxa that closely match the query, along with their associated
keys. The name in the first row is the best match that
<code><a href="https://docs.ropensci.org/rgbif/reference/name_suggest.html" class="external-link">rgbif::name_suggest()</a></code> found. The first row is the exact
correct taxon, so we will use this key to download occurrence records
from GBIF.</p>
<p>First, let’s save the key as a variable for use in the call to
download data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Re-run name_suggest() call to save table</span></span>
<span><span class="va">suggestions</span> <span class="op">&lt;-</span> <span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/name_suggest.html" class="external-link">name_suggest</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">query</span>, rank <span class="op">=</span> <span class="va">rank</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The correct key is the first element in the first row</span></span>
<span><span class="va">key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">suggestions</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print key</span></span>
<span><span class="va">key</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2467262</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="downloading-occurrence-records-using-occ_download">Downloading Occurrence Records Using occ_download()<a class="anchor" aria-label="anchor" href="#downloading-occurrence-records-using-occ_download"></a>
</h2>
<p>Next, we can use <code><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">rgbif::occ_download()</a></code> or
<code><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">rgbif::occ_search()</a></code> to gather occurrence records for the
taxon of interest (<em>Anolis allisoni</em>).</p>
<p>The <code><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">rgbif::occ_download()</a></code> function is much more robust
than the <code><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">rgbif::occ_search()</a></code> function, as the
<code><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">rgbif::occ_download()</a></code> function does not have a limit to the
number of occurrence records returned, while the
<code><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">rgbif::occ_search()</a></code> function does. In addition, the
<code><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">rgbif::occ_download()</a></code> function creates a record of your
downloaded dataset with an associated DOI for proper citation in your
publications that utilize this data (<a href="https://www.gbif.org/user/download" class="external-link">found in the Downloads tab on
your GBIF User page</a>).</p>
<p>The <code><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">rgbif::occ_download()</a></code> function requires the user to
have a GBIF account to use it, <a href="https://docs.ropensci.org/rgbif/articles/gbif_credentials.html" class="external-link">so
please follow the instructions here to set your GBIF username and
password in your R environment</a> before continuing with this
vignette.</p>
<p>Once your GBIF credentials are added to your .Renviron file, you can
run <code>rbif::occ_download()</code> as written below. Please also
reference <a href="https://docs.ropensci.org/rgbif/articles/getting_occurrence_data.html" class="external-link">the
official vignette associated with this function to learn more
details</a>.</p>
<p>The <code><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">rgbif::occ_download()</a></code> call includes the following
elements:</p>
<ul>
<li>
<code>pred("taxonKey", key)</code>: The taxon key for <em>Anolis
allisoni</em> that we saved above.</li>
<li>
<code>pred("hasCoordinate"</code>, TRUE): Ensures that all returned
records have an associated GPS coordinate.</li>
<li>
<code>pred("hasGeospatialIssue"</code>, FALSE): Ensures that none of
the returned records have a known geospatial issue.</li>
<li>
<code>format = "DWCA"</code>: The most data-rich return format for
the data. Contains information necessary for downstream <em>SSARP</em>
functions.</li>
</ul>
<pre><code><span><span class="va">download_key</span> <span class="op">&lt;-</span> <span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">occ_download</a></span><span class="op">(</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred</a></span><span class="op">(</span><span class="st">"taxonKey"</span>, <span class="va">key</span><span class="op">)</span>,</span>
<span>                                    <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred</a></span><span class="op">(</span><span class="st">"hasCoordinate"</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                                    <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred</a></span><span class="op">(</span><span class="st">"hasGeospatialIssue"</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                                    format <span class="op">=</span> <span class="st">"DWCA"</span><span class="op">)</span></span></code></pre>
<p>The <code>download_key</code> object now contains a unique identifier
for your download. We can run
<code>occ_download_wait(download_key)</code> to receive an update about
the status of your download. Once the download has completed, the status
will read “succeeded.” Please note that your download may take longer
than the time limit for receiving active updates with
<code><a href="https://docs.ropensci.org/rgbif/reference/occ_download_wait.html" class="external-link">rgbif::occ_download_wait()</a></code>, which will result in a
<code>curl</code> error that states <code>Timeout was reached</code>.
This does not mean that your download failed! When in doubt, check <a href="https://www.gbif.org/user/download" class="external-link">the Downloads tab on your GBIF
User page</a>.</p>
<p>Now that the download has succeeded, the
<code><a href="https://docs.ropensci.org/rgbif/reference/occ_download_get.html" class="external-link">rgbif::occ_download_get()</a></code> function will allow us to
download the data as a <code>.zip</code> file into the current working
directory. This file is then piped into
<code><a href="https://docs.ropensci.org/rgbif/reference/occ_download_import.html" class="external-link">rgbif::occ_download_import()</a></code> to import the occurrence data
into the current R Environment as the <code>dat</code> object.</p>
<pre><code><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_download_get.html" class="external-link">occ_download_get</a></span><span class="op">(</span><span class="va">download_key</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_download_import.html" class="external-link">occ_download_import</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Print first 5 lines of dat</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre>
<pre><code><span><span class="co">## # A tibble: 6 × 225</span></span>
<span><span class="co">##      gbifID accessRights bibliographicCitation language license  modified            publisher references rightsHolder</span></span>
<span><span class="co">##     &lt;int64&gt; &lt;chr&gt;        &lt;chr&gt;                 &lt;chr&gt;    &lt;chr&gt;    &lt;dttm&gt;              &lt;lgl&gt;     &lt;chr&gt;      &lt;chr&gt;  ##      </span></span>
<span><span class="co">## 1 812099598 ""           ""                    ""       CC_BY_N… 2024-12-20 18:02:42 NA        http://mc… President a…</span></span>
<span><span class="co">## 2 812099597 ""           ""                    ""       CC_BY_N… 2024-12-20 16:17:35 NA        http://mc… President a…</span></span>
<span><span class="co">## 3 812099596 ""           ""                    ""       CC_BY_N… 2024-12-20 18:01:51 NA        http://mc… President a…</span></span>
<span><span class="co">## 4 812099594 ""           ""                    ""       CC_BY_N… 2024-12-20 16:17:35 NA        http://mc… President a…</span></span>
<span><span class="co">## 5 812099593 ""           ""                    ""       CC_BY_N… 2024-12-20 18:01:51 NA        http://mc… President a…</span></span>
<span><span class="co">## 6 812099592 ""           ""                    ""       CC_BY_N… 2024-12-20 16:17:35 NA        http://mc… President a…</span></span>
<span><span class="co">## # ℹ 216 more variables: type &lt;chr&gt;, institutionID &lt;chr&gt;, collectionID &lt;chr&gt;, datasetID &lt;chr&gt;, institutionCode &lt;chr&gt;,</span></span>
<span><span class="co">## #   collectionCode &lt;chr&gt;, datasetName &lt;chr&gt;, ownerInstitutionCode &lt;chr&gt;, basisOfRecord &lt;chr&gt;,</span></span>
<span><span class="co">## #   informationWithheld &lt;chr&gt;, dataGeneralizations &lt;lgl&gt;, dynamicProperties &lt;chr&gt;, occurrenceID &lt;chr&gt;,</span></span>
<span><span class="co">## #   catalogNumber &lt;chr&gt;, recordNumber &lt;chr&gt;, recordedBy &lt;chr&gt;, recordedByID &lt;chr&gt;, individualCount &lt;int&gt;,</span></span>
<span><span class="co">## #   organismQuantity &lt;dbl&gt;, organismQuantityType &lt;chr&gt;, sex &lt;chr&gt;, lifeStage &lt;chr&gt;, reproductiveCondition &lt;lgl&gt;,</span></span>
<span><span class="co">## #   caste &lt;lgl&gt;, behavior &lt;lgl&gt;, vitality &lt;chr&gt;, establishmentMeans &lt;chr&gt;, degreeOfEstablishment &lt;lgl&gt;,</span></span>
<span><span class="co">## #   pathway &lt;lgl&gt;, georeferenceVerificationStatus &lt;chr&gt;, occurrenceStatus &lt;chr&gt;, preparations &lt;chr&gt;, …</span></span>
<span><span class="co">## # ℹ Use `colnames()` to see all variable names</span></span></code></pre>
<p>The <code>dat</code> object is now ready to be used with the rest of
the <em>SSARP</em> pipeline!</p>
</div>
<div class="section level2">
<h2 id="downloading-occurrence-records-using-occ_search">Downloading Occurrence Records Using occ_search()<a class="anchor" aria-label="anchor" href="#downloading-occurrence-records-using-occ_search"></a>
</h2>
<p>While <code><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">rgbif::occ_download()</a></code> is the optimal method for
gathering occurrence data from GBIF, the
<code><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">rgbif::occ_search()</a></code> function is very useful for quick
downloads that allow the user to explore occurrence records before
committing to downloading a full dataset.</p>
<p>In this example, we will download the first 1000 records for the
entire <em>Anolis</em> genus on GBIF.</p>
<p>Similar to the <code><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">rgbif::occ_download()</a></code> example, we will
start by finding the taxon key associated with the <em>Anolis</em>
genus.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">query</span> <span class="op">&lt;-</span> <span class="st">"Anolis"</span></span>
<span><span class="va">rank</span> <span class="op">&lt;-</span> <span class="st">"Genus"</span></span>
<span></span>
<span><span class="va">suggestions</span> <span class="op">&lt;-</span> <span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/name_suggest.html" class="external-link">name_suggest</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">query</span>, rank <span class="op">=</span> <span class="va">rank</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The correct key is the first element in the first row</span></span>
<span><span class="va">key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">suggestions</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print key</span></span>
<span><span class="va">key</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 8782549</span></span></code></pre>
<p>Next, we will use the <code><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">rgbif::occ_search()</a></code> function to
obtain the first 1000 occurrence records for <em>Anolis</em> from
GBIF.</p>
<p>The <code><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">rgbif::occ_search()</a></code> call includes the following
elements:</p>
<ul>
<li>
<code>taxonKey</code>: The taxon key for <em>Anolis</em> that we
saved above.</li>
<li>
<code>hasCoordinate = TRUE</code>: Ensures that all returned records
have an associated GPS coordinate.</li>
<li>
<code>limit</code>: The number of records returned.</li>
</ul>
<pre><code><span><span class="co"># Limit for number of records returned</span></span>
<span><span class="va">limit</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="va">occurrences</span> <span class="op">&lt;-</span> <span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">occ_search</a></span><span class="op">(</span>taxonKey <span class="op">=</span> <span class="va">key</span>, </span>
<span>                                 hasCoordinate <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                 limit <span class="op">=</span> <span class="va">limit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The occurrences object is a list including metadata</span></span>
<span><span class="co"># Access the occurrence records itself through:</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">occurrences</span><span class="op">$</span><span class="va">data</span></span>
<span></span>
<span><span class="co"># Print first 5 rows of dat</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre>
<pre><code><span><span class="co">## # A tibble: 6 × 105</span></span>
<span><span class="co">##   key        scientificName        decimalLatitude decimalLongitude issues datasetKey publishingOrgKey installationKey</span></span>
<span><span class="co">##   &lt;chr&gt;      &lt;chr&gt;                           &lt;dbl&gt;            &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;          </span></span>
<span><span class="co">## 1 5006700320 Anolis sagrei Duméri…            25.8            -80.1 cdc,c… 50c9509d-… 28eb1a3f-1c15-4… 997448a8-f762-…</span></span>
<span><span class="co">## 2 5006700950 Anolis lineatus Daud…            12.3            -69.0 cdc,c… 50c9509d-… 28eb1a3f-1c15-4… 997448a8-f762-…</span></span>
<span><span class="co">## 3 5006703032 Anolis sagrei Duméri…            26.4            -80.2 cdc,c… 50c9509d-… 28eb1a3f-1c15-4… 997448a8-f762-…</span></span>
<span><span class="co">## 4 5006714560 Anolis carolinensis …            30.4            -87.5 cdc,c… 50c9509d-… 28eb1a3f-1c15-4… 997448a8-f762-…</span></span>
<span><span class="co">## 5 5006714725 Anolis sagrei Duméri…            26.3            -80.1 cdc,c… 50c9509d-… 28eb1a3f-1c15-4… 997448a8-f762-…</span></span>
<span><span class="co">## 6 5006715278 Anolis carolinensis …            33.1           -117.  cdc,c… 50c9509d-… 28eb1a3f-1c15-4… 997448a8-f762-…</span></span>
<span><span class="co">## # ℹ 97 more variables: hostingOrganizationKey &lt;chr&gt;, publishingCountry &lt;chr&gt;, protocol &lt;chr&gt;, lastCrawled &lt;chr&gt;,</span></span>
<span><span class="co">## #   lastParsed &lt;chr&gt;, crawlId &lt;int&gt;, projectId &lt;chr&gt;, basisOfRecord &lt;chr&gt;, occurrenceStatus &lt;chr&gt;, taxonKey &lt;int&gt;,</span></span>
<span><span class="co">## #   kingdomKey &lt;int&gt;, phylumKey &lt;int&gt;, classKey &lt;int&gt;, familyKey &lt;int&gt;, genusKey &lt;int&gt;, speciesKey &lt;int&gt;,</span></span>
<span><span class="co">## #   acceptedTaxonKey &lt;int&gt;, acceptedScientificName &lt;chr&gt;, kingdom &lt;chr&gt;, phylum &lt;chr&gt;, family &lt;chr&gt;, genus &lt;chr&gt;,</span></span>
<span><span class="co">## #   species &lt;chr&gt;, genericName &lt;chr&gt;, specificEpithet &lt;chr&gt;, taxonRank &lt;chr&gt;, taxonomicStatus &lt;chr&gt;,</span></span>
<span><span class="co">## #   iucnRedListCategory &lt;chr&gt;, dateIdentified &lt;chr&gt;, coordinateUncertaintyInMeters &lt;dbl&gt;, continent &lt;chr&gt;,</span></span>
<span><span class="co">## #   stateProvince &lt;chr&gt;, year &lt;int&gt;, month &lt;int&gt;, day &lt;int&gt;, eventDate &lt;chr&gt;, startDayOfYear &lt;int&gt;, …</span></span></code></pre>
<p>The <code>dat</code> object is now ready to be used with the rest of
the <em>SSARP</em> pipeline for further exploration! If you would like
to use this data in a publication, please consider using
<code><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">rgbif::occ_download()</a></code> instead so that there is a DOI
automatically associated with the data.</p>
<p>If you must use data obtained through
<code><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">rgbif::occ_search()</a></code> in a publication, you must create a
Derived Dataset. The <code><a href="../reference/get_sources.html">SSARP::get_sources()</a></code> function helps
users create a dataframe of dataset keys and the number of occurrence
records associated with each key, which is necessary for uploading a
Derived Dataset.</p>
<p>Find <a href="https://www.gbif.org/derived-dataset/about" class="external-link">the
definition of a Derived Dataset here</a> and <a href="https://data-blog.gbif.org/post/derived-datasets/" class="external-link">more
information about their creation here</a>.</p>
<p>The <code><a href="../reference/get_sources.html">SSARP::get_sources()</a></code> function may be used as seen
below:</p>
<pre><code><span><span class="va">source_df</span> <span class="op">&lt;-</span> <span class="fu">SSARP</span><span class="fu">::</span><span class="fu"><a href="../reference/get_sources.html">get_sources</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print first 5 lines of source_df</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">source_df</span><span class="op">)</span></span></code></pre>
<pre><code><span><span class="co">##                             datasetKey   n</span></span>
<span><span class="co">## 1 50c9509d-22c7-4a22-a47d-8c48425ef4a7 997</span></span>
<span><span class="co">## 2 8a863029-f435-446a-821e-275f4f641165   3</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="restricting-occurrence-records-using-geometry">Restricting Occurrence Records Using Geometry<a class="anchor" aria-label="anchor" href="#restricting-occurrence-records-using-geometry"></a>
</h2>
<p>When using <code><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">rgbif::occ_download()</a></code> and
<code><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">rgbif::occ_search()</a></code>, the user can specify a well-known text
(WKT) representation of geometry to restrict the geographic location of
the returned occurrence records. The <code>rgbif</code> package requires
a counter-clockwise winding order for WKT.</p>
<p>I find it helpful to think about WKT polygons in this way: imagine a
polygon around your geographic area of interest and pick one of the
corners as a starting point. The order of points in WKT format should
follow counter-clockwise from the corner you picked first, and the final
entry in the WKT string needs to be the same as the first entry.
Additionally, while GPS points are typically represented in “latitude,
longitude” format, WKT expects them in “longitude latitude” format with
commas separating the points rather than individual longitude and
latitude values.</p>
<p>For a visual example, here is a polygon situated around Caribbean
islands (Figure 1).</p>
<div class="float">
<img src="CaribbeanSpots_Final.png" style="width:100.0%" alt="Figure 1. The GPS points associated with the WKT polygon in this example."><div class="figcaption">Figure 1. The GPS points associated with the WKT
polygon in this example.</div>
</div>
<p>The WKT polygon for this example is ‘POLYGON((-84.8 23.9, -84.7 16.4,
-65.2 13.9, -63.1 11.0, -56.9 15.5, -60.5 21.9, -79.3 27.8, -79.8 24.8,
-84.8 23.9))’. The first point, normally represented by “23.9, -84.8”
but written as “-84.8 23.9” for WKT, is circled in orange in Figure
2.</p>
<div class="float">
<img src="FirstSpot.png" style="width:100.0%" alt="Figure 2. The first point in this example."><div class="figcaption">Figure 2. The first point in this example.</div>
</div>
<p>Then, the next point, normally represented by “16.4, -84.7” but
written as “-84.7 16.4” for WKT, follows counter-clockwise from the
first one (circled in Figure 3).</p>
<div class="float">
<img src="SecondSpot.png" style="width:100.0%" alt="Figure 3. The second point in this example."><div class="figcaption">Figure 3. The second point in this
example.</div>
</div>
<p>The rest of the points then follow in the order labeled in orange
numbers in Figure 4. Make sure to close the polygon by ending the WKT
string with the same point that you started with (“-84.8 23.9” in this
case, represented by both 1 and 9 on Figure 4).</p>
<div class="float">
<img src="NumberSpots.png" style="width:100.0%" alt="Figure 4. Order of points used in WKT polygon example. Numbers 1 and 9 are the same point because the polygon must start and end with the same point."><div class="figcaption">Figure 4. Order of points used in WKT polygon
example. Numbers 1 and 9 are the same point because the polygon must
start and end with the same point.</div>
</div>
<p>WKT polygons may be used in both <code><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">rgbif::occ_download()</a></code>
and <code><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">rgbif::occ_search()</a></code> as seen below. Please note that
variables created earlier in this document are referenced here:</p>
<pre><code><span><span class="co"># occ_download() example</span></span>
<span><span class="va">download_key</span> <span class="op">&lt;-</span> <span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">occ_download</a></span><span class="op">(</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred</a></span><span class="op">(</span><span class="st">"taxonKey"</span>, <span class="va">key</span><span class="op">)</span>,</span>
<span>                              <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred</a></span><span class="op">(</span><span class="st">"hasCoordinate"</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                              <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred</a></span><span class="op">(</span><span class="st">"hasGeospatialIssue"</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                              <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred_within</a></span><span class="op">(</span><span class="st">'POLYGON((-84.8 23.9, -84.7 16.4, -65.2 13.9, -63.1 11.0, -56.9 15.5, -60.5 21.9, -79.3 27.8, -79.8 24.8, -84.8 23.9))'</span><span class="op">)</span>,</span>
<span>                              format <span class="op">=</span> <span class="st">"DWCA"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># occ_search() example</span></span>
<span><span class="va">occurrences</span> <span class="op">&lt;-</span> <span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">occ_search</a></span><span class="op">(</span>taxonKey <span class="op">=</span> <span class="va">key</span>, </span>
<span>                                hasCoordinate <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                limit <span class="op">=</span> <span class="va">limit</span>,</span>
<span>                                geometry <span class="op">=</span> <span class="st">'POLYGON((-84.8 23.9, -84.7 16.4, -65.2 13.9, -63.1 11.0, -56.9 15.5, -60.5 21.9, -79.3 27.8, -79.8 24.8, -84.8 23.9))'</span><span class="op">)</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kristen Martinet.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
