<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Construct a Speciation-Area Relationship with SSARP • SSARP</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Construct a Speciation-Area Relationship with SSARP">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SSARP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Create_SAR.html">Create Species-Area Relationship</a></li>
    <li><a class="dropdown-item" href="../articles/Create_SpAR.html">Create Speciation-Area Relationship</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kmartinet/SSARP/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Construct a Speciation-Area Relationship with SSARP</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kmartinet/SSARP/blob/main/vignettes/Create_SpAR.Rmd" class="external-link"><code>vignettes/Create_SpAR.Rmd</code></a></small>
      <div class="d-none name"><code>Create_SpAR.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>A speciation-area relationship (SpAR) plots speciation rates against
the area of the island on which the associated species live. This
vignette, which covers how to create a SpAR using the <em>SSARP</em>
package, uses knowledge and data generated from <a href="https://kmartinet.github.io/SSARP/articles/Create_SAR.html">the
vignette describing the creation of species-area relationships</a>. Code
relevant to generating the necessary data for this SpAR example from the
species-area relationship (SAR) vignette will be included here, but the
reader is encouraged to read <a href="https://kmartinet.github.io/SSARP/articles/Create_SAR.html">the
SAR vignette</a> for additional details.</p>
<p>In this vignette, we will create a SpAR for the lizard genus
<em>Anolis</em>, as a continuation of the SAR vignette.</p>
</div>
<div class="section level2">
<h2 id="generate-occurrence-data">Generate Occurrence Data<a class="anchor" aria-label="anchor" href="#generate-occurrence-data"></a>
</h2>
<p>First, we will generate the “nocont_dat” object from the SAR
vignette, which includes occurrence records and their associated island
names and areas for <em>Anolis</em> lizards that live on Caribbean
islands.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kmartinet/SSARP" class="external-link">SSARP</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the GBIF key for the Anolis genus</span></span>
<span><span class="va">key</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getKey.html">getKey</a></span><span class="op">(</span>query <span class="op">=</span> <span class="st">"Anolis"</span>, rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get data for Anolis from GBIF from islands in the Caribbean</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">SSARP</span><span class="fu">::</span><span class="fu"><a href="../reference/getData.html">getData</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">key</span>, limit <span class="op">=</span> <span class="fl">10000</span>, geometry <span class="op">=</span> <span class="st">'POLYGON((-84.8 23.9, -84.7 16.4, -65.2 13.9, -63.1 11.0, -56.9 15.5, -60.5 21.9, -79.3 27.8, -79.8 24.8, -84.8 23.9))'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find land mass names</span></span>
<span><span class="va">land_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findLand.html">findLand</a></span><span class="op">(</span>occurrences <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the land mass names to get their areas</span></span>
<span><span class="va">area_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findAreas.html">findAreas</a></span><span class="op">(</span>occs <span class="op">=</span> <span class="va">land_dat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove continents from the filtered occurrence record dataset</span></span>
<span><span class="va">nocont_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/removeContinents.html">removeContinents</a></span><span class="op">(</span>occs <span class="op">=</span> <span class="va">area_dat</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calculate-speciation-rates">Calculate Speciation Rates<a class="anchor" aria-label="anchor" href="#calculate-speciation-rates"></a>
</h2>
<p>The “nocont_dat” object created above can be used with a phylogenetic
tree to create a SpAR. This step in the <em>SSARP</em> workflow enables
the user to determine whether the breakpoint in the SAR corresponds with
a threshold for island size at which in situ speciation occurs (see
Losos and Schluter 2000).</p>
<p>The phylogenetic tree for <em>Anolis</em> that we will use in this
example is a trimmed version of the tree used by Patton et al. (2021).
This trimmed tree only includes anoles found on islands in the
Caribbean. In order to read the tree, we must use the <em>ape</em> R
package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/emmanuelparadis/ape" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">read.tree</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Patton_Anolis_Trimmed.tree"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="anolis_tree.png" alt="Phylogenetic tree from Patton et al. (2021) trimmed to include only anoles found on islands in the Caribbean."><div class="figcaption">Phylogenetic tree from Patton et al. (2021)
trimmed to include only anoles found on islands in the Caribbean.</div>
</div>
<p>Now that we have a phylogenetic tree, we can estimate tip speciation
rates for use in our speciation-area relationship. <em>SSARP</em>
includes three methods for estimating tip speciation rates: BAMM
(Rabosky 2014), the lambda calculation for crown groups from Magallόn
and Sanderson (2001), and DR (Jetz et al. 2012). In this example, we
will use the lambda calculation for crown groups from Magallόn and
Sanderson (2001) through the “speciationMS” function in <em>SSARP</em>.
The “label_type” parameter in this function tells <em>SSARP</em> whether
the tip labels on the given tree include the full species name
(binomial) or just the specific epithet (epithet).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate tip speciation rates using the lambda calculation for crown groups from Magallόn and Sanderson (2001)</span></span>
<span><span class="va">speciation_occurrences</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/speciationMS.html">speciationMS</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">tree</span>, label_type <span class="op">=</span> <span class="st">"epithet"</span>, occurrences <span class="op">=</span> <span class="va">nocont_dat</span><span class="op">)</span></span></code></pre></div>
<p>The “speciation_occurrences” object is a dataframe containing island
areas with their corresponding speciation rate as estimated by the
“speciationMS” function.</p>
</div>
<div class="section level2">
<h2 id="create-speciation-area-relationship">Create Speciation-Area Relationship<a class="anchor" aria-label="anchor" href="#create-speciation-area-relationship"></a>
</h2>
<p>Next, we will use the “speciation_occurrences” object with the
“SpeARP” function to create a SpAR. Just like the “SARP” function, the
“SpeARP” function creates multiple regression objects with breakpoints
up to the user-specified “npsi” parameter. For example, if “npsi” is
two, “SpeARP” will generate regression objects with zero (linear
regression), one, and two breakpoints. The function will then return the
regression object with the lowest AIC score. The “npsi” parameter will
be set to one in this example. Note that if linear regression (zero
breakpoints) is better-supported than segmented regression with one
breakpoint, the linear regression will be returned instead.</p>
<p>The final parameter is the “MS” parameter, which tells <em>SSARP</em>
whether the user generated speciation rate estimates using the
“speciationMS” function (TRUE) or not (FALSE). This is an important
parameter because if “speciationMS” is used, the speciation rate
calculation already log-transforms the values. The other speciation rate
estimation methods do not automatically log-transform the speciation
rate values.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SpeARP.html">SpeARP</a></span><span class="op">(</span>occurrences <span class="op">=</span> <span class="va">speciation_occurrences</span>, npsi <span class="op">=</span> <span class="fl">1</span>, MS <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figure/anolis_SpAR-1.png" alt="plot of chunk anolis_SpAR"><div class="figcaption">plot of chunk anolis_SpAR</div>
</div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  ***Regression Model with Segmented Relationship(s)***</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call: </span></span>
<span><span class="co">## segmented.lm(obj = linear, seg.Z = ~x, npsi = 1, control = seg.control(display = FALSE))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimated Break-Point(s):</span></span>
<span><span class="co">##           Est. St.Err</span></span>
<span><span class="co">## psi1.x 19.924  1.002</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients of the linear terms:</span></span>
<span><span class="co">##               Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">## (Intercept)  2.058e-11  2.158e-02    0.00        1</span></span>
<span><span class="co">## x           -1.244e-12  1.188e-03    0.00        1</span></span>
<span><span class="co">## U1.x         5.712e-03  2.085e-03    2.74       NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.01037 on 34 degrees of freedom</span></span>
<span><span class="co">## Multiple R-Squared: 0.3996,  Adjusted R-squared: 0.3466 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Boot restarting based on 6 samples. Last fit:</span></span>
<span><span class="co">## Convergence attained in 3 iterations (rel. change 2.3011e-16)</span></span></code></pre>
<p>This is the SpAR for <em>Anolis</em> including island-based
occurrences within a polygon around Caribbean islands from the first
10000 records for the genus in GBIF! The best-fit model was a segmented
regression with one breakpoint.</p>
<p>You will notice that two of the largest islands have a speciation
rate of zero in this example. This very likely occurred because the
calculation for speciation rate in Magallόn and Sanderson (2001) that
“speciationMS” uses is based on monophyly, which can be disrupted on
islands with non-native species occurrence records. When using the
“speciationMS” function to estimate speciation rates for a SpAR, it is
incredibly important to manually filter the returned occurrence records
to remove non-native species.</p>
<div class="section level3">
<h3 id="literature-cited">Literature Cited<a class="anchor" aria-label="anchor" href="#literature-cited"></a>
</h3>
<ul>
<li>Jetz, W., Thomas, G.H., Joy, J.B., Hartmann, K., &amp; Mooers, A.O.
(2012). The global diversity of birds in space and time. Nature, 491:
444-448.</li>
<li>Losos, J.B. &amp; Schluter, D. (2000). Analysis of an evolutionary
species-area relationship. Nature, 408: 847-850.</li>
<li>Magallόn, S. &amp; Sanderson, M.J. (2001). Absolute Diversification
Rates in Angiosperm Clades. Evolution, 55(9): 1762-1780.</li>
<li>Patton, A.H., Harmon, L.J., del Rosario Castañeda, M., Frank, H.K.,
Donihue, C.M., Herrel, A., &amp; Losos, J.B. (2021). When adaptive
radiations collide: Different evolutionary trajectories between and
within island and mainland lizard clades. PNAS, 118(42):
e2024451118.</li>
<li>Rabosky, D.L. (2014). Automatic Detection of Key Innovations, Rate
Shifts, and Diversity-Dependence on Phylogenetic Trees. PLOS ONE, 9(2):
e89543.</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kristen Martinet.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
